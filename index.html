<!DOCTYPE html>
<html>
<head>
    <title>MUJ Navigator</title>
    <link rel="icon" type="image/png" href="image/manipallogo.png">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- ADDED: your custom/fancy CSS (keeps look you asked for) -->
    <style>
        :root{
            --accent1: linear-gradient(135deg,#ff9966,#ff5e62);
            --accent-route: #00bcd4;
            --muted-road: #bfc4c6;
            --glass: rgba(255,255,255,0.12);
            --glass-strong: rgba(255,255,255,0.22);
            --ui-radius: 12px;
            --shadow: 0 10px 30px rgba(12,18,26,0.18);
        }

        /* global */
        html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
        #map{height:100vh;width:100%;background:#eaecef}

        /* --- Your original fancy input-box styles --- */
        .input-box{
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1200;
            width: calc(100% - 30px);
            max-width: 820px;
            padding: 10px;
            display:flex;
            gap:10px;
            align-items:center;
            border-radius:var(--ui-radius);
            background: var(--accent1);
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px) saturate(120%);
            border:1px solid rgba(255,255,255,0.06);
        }
        .input-left{ display:flex; gap:10px; align-items:center; flex:1 1 auto; }
        .input-left input{
            min-width:130px;
            padding:10px 12px;
            border-radius:10px;
            border:none;
            background: rgba(255,255,255,0.14);
            color:white;
            outline:none;
            font-size:15px;
        }
        .input-left input::placeholder{ color: rgba(255,255,255,0.95); font-style:italic; }

        .btn {
            padding: 10px 14px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            background: rgba(0,0,0,0.18);
            color: #fff;
            font-weight:600;
            display:inline-flex;
            align-items:center;
            gap:8px;
        }
        .icon-btn {
            width:42px;height:42px;padding:0;justify-content:center;
            background: rgba(255,255,255,0.08);
        }
        .btn:hover{ transform: translateY(-2px); filter:brightness(1.03); }

        /* Suggestion dropdown (custom lightweight) */
        .suggestions {
            position:absolute;
            top: 58px; /* relative to .input-box, adjust */
            left: 50%;
            transform: translateX(-50%);
            z-index:1300;
            width: calc(100% - 30px);
            max-width:820px;
            pointer-events:none;
        }
        .suggest-list {
            pointer-events:auto;
            display:flex;
            gap:8px;
            padding:8px;
            background: rgba(0,0,0,0.55);
            border-radius:10px;
            box-shadow: var(--shadow);
            color:#fff;
        }
        .suggest-item {
            padding:8px 10px;
            border-radius:8px;
            background: rgba(255,255,255,0.06);
            cursor:pointer;
            font-weight:600;
            font-size:14px;
        }
        .suggest-item:hover { background: rgba(255,255,255,0.12); }

        /* Info box bottom-left */
        .travel-info-box {
            position: absolute;
            bottom: 14px;
            left: 14px;
            z-index: 1200;
            background: rgba(12,17,22,0.75);
            color: #fff;
            padding: 10px 12px;
            border-radius: 10px;
            font-size:14px;
            box-shadow: 0 8px 22px rgba(0,0,0,0.25);
            backdrop-filter: blur(6px);
            min-width:160px;
        }
        .travel-info-box b{display:block;margin-bottom:6px;font-size:13px}

        /* Live location toggle */
        .live-toggle {
            position:absolute;
            bottom:14px;
            right:14px;
            z-index:1200;
            background: rgba(255,255,255,0.08);
            color:#fff;
            padding:8px 10px;
            border-radius:10px;
            border:1px solid rgba(255,255,255,0.04);
            cursor:pointer;
            box-shadow: var(--shadow);
        }

        /* small responsive adjustments */
        @media (max-width:720px){
            .input-box{ width: calc(100% - 18px); padding:8px; gap:8px; top:10px; }
            .suggestions { top: 56px; }
            .input-left input { min-width: 90px; font-size:14px; padding:9px; }
        }

        /* --- MAPPINGS: apply your CSS look to the existing HTML class names
           The code you gave uses .search-box, #info-box and #suggestions.
           We map them to the styles above so nothing else in your JS/HTML needed to change. --- */

        /* apply input-box look to existing .search-box (so we didn't need to change HTML) */
        .search-box {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1200;
            width: calc(100% - 30px);
            max-width: 820px;
            padding: 10px;
            display:flex;
            gap:10px;
            align-items:center;
            border-radius:var(--ui-radius);
            background: var(--accent1);
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px) saturate(120%);
            border:1px solid rgba(255,255,255,0.06);
        }
        .search-box input {
            min-width:130px;
            padding:10px 12px;
            border-radius:10px;
            border:none;
            background: rgba(255,255,255,0.14);
            color:white;
            outline:none;
            font-size:15px;
        }
        .search-box input::placeholder { color: rgba(255,255,255,0.9); font-style:italic; }

        /* suggestions mapping to your suggest-list style */
        #suggestions {
            position:absolute;
            top: 58px;
            left: 50%;
            transform: translateX(-50%);
            z-index:1300;
            width: calc(100% - 30px);
            max-width:820px;
            pointer-events:auto;
            display:none; /* hidden until needed */
        }
        #suggestions .list {
            display:flex;
            gap:8px;
            padding:8px;
            background: rgba(0,0,0,0.55);
            border-radius:10px;
            box-shadow: var(--shadow);
            color:#fff;
            flex-wrap:wrap;
            justify-content:center;
        }
        #suggestions .item {
            padding:8px 10px;
            border-radius:8px;
            background: rgba(255,255,255,0.06);
            cursor:pointer;
            font-weight:600;
            font-size:14px;
        }
        #suggestions .item:hover { background: rgba(255,255,255,0.12); }

        /* info box mapping */
        #info-box {
            position: absolute;
            bottom: 14px;
            left: 14px;
            z-index: 1200;
            background: rgba(12,17,22,0.75);
            color: #fff;
            padding: 10px 12px;
            border-radius: 10px;
            font-size:14px;
            box-shadow: 0 8px 22px rgba(0,0,0,0.25);
            backdrop-filter: blur(6px);
            min-width:160px;
        }

        /* keep small defaults (so Leaflet controls etc still look ok) */
        .leaflet-container a.leaflet-control-zoom-in,
        .leaflet-container a.leaflet-control-zoom-out { font-weight: bold; }
    </style>
</head>
<body>
    <!-- KEEP your original HTML exactly as you last sent it -->
    <div class="search-box">
        <input id="from" type="text" placeholder="From (leave empty for my location)">
        <input id="to" type="text" placeholder="To">
        <button onclick="startNavigation()">Go</button>
        <button onclick="getMyLocation()">üìç</button>
    </div>

    <!-- suggestions element (styled by CSS mapping above) -->
    <div id="suggestions"><div class="list" id="suggestList"></div></div>

    <div id="map"></div>
    <div id="info-box">Distance: - | Time: -</div>

    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // --- KEEP your JS exactly as before (no functional changes) ---
        var map = L.map('map').setView([26.8436, 75.5650], 17);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 20,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Load campus roads (grey, minimal)
        fetch('export.geojson')
            .then(res => res.json())
            .then(data => {
                L.geoJSON(data, { style: { color: '#aaa', weight: 1 } }).addTo(map);
            })
            .catch(err => console.error("GeoJSON load error:", err));

        // Campus locations
        const campusLocations = {
            "AB1": [26.8431, 75.5655],
            "AB2": [26.8422, 75.5658],
            "Central Library": [26.8438, 75.5665],
            "Mess": [26.8443, 75.5648],
            "Laundry": [26.8440, 75.5639]
        };

        var userMarker, routeLine, watchID;

        // Track live location (watch)
        function getMyLocation() {
            if (watchID) navigator.geolocation.clearWatch(watchID);
            if (!navigator.geolocation) {
                alert("Geolocation not supported by your browser.");
                return;
            }
            watchID = navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                if (userMarker) userMarker.setLatLng([lat, lng]);
                else userMarker = L.marker([lat, lng]).addTo(map).bindPopup("You are here");
                map.setView([lat, lng], 18);
                document.getElementById('from').value = `${lat},${lng}`;
            }, err => {
                alert("Location access denied.");
            }, { enableHighAccuracy: true });
        }

        // Start the navigation: draw route line + calculate distance/time
        function startNavigation() {
            let fromVal = document.getElementById('from').value;
            let toVal = document.getElementById('to').value;

            let fromCoords = parseCoordsOrName(fromVal);
            let toCoords = parseCoordsOrName(toVal);

            if (!fromCoords || !toCoords) {
                alert("Please select valid points.");
                return;
            }

            if (routeLine) map.removeLayer(routeLine);

            // Draw route line
            routeLine = L.polyline([fromCoords, toCoords], { color: 'blue', weight: 4 }).addTo(map);
            map.fitBounds(routeLine.getBounds());

            // Calculate distance/time
            let dist = map.distance(fromCoords, toCoords);
            let walkingSpeed = 1.4; // meters/sec
            let timeSec = dist / walkingSpeed;
            document.getElementById('info-box').innerHTML =
                `Distance: ${(dist/1000).toFixed(2)} km | Time: ${(timeSec/60).toFixed(1)} min`;
        }

        function parseCoordsOrName(val) {
            if (!val) return null;
            if (val.includes(",")) {
                let [lat, lng] = val.split(",").map(Number);
                if (Number.isFinite(lat) && Number.isFinite(lng)) return [lat, lng];
                return null;
            }
            if (campusLocations[val]) return campusLocations[val];
            return null;
        }

        // Suggestions: show matching campus locations under the top box
        const suggestList = document.getElementById('suggestList');
        const suggestionsWrapper = document.getElementById('suggestions');

        function showSuggestions(query) {
            suggestList.innerHTML = '';
            if (!query) { suggestionsWrapper.style.display = 'none'; return; }
            for (let name in campusLocations) {
                if (name.toLowerCase().includes(query.toLowerCase())) {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.textContent = name;
                    item.onclick = () => {
                        document.getElementById('to').value = name;
                        suggestList.innerHTML = '';
                        suggestionsWrapper.style.display = 'none';
                    };
                    suggestList.appendChild(item);
                }
            }
            // show only if we added results
            suggestionsWrapper.style.display = suggestList.children.length ? 'block' : 'none';
        }

        document.getElementById('to').addEventListener('input', function() {
            showSuggestions(this.value);
        });

        // hide suggestions if clicking outside
        document.addEventListener('click', (e) => {
            const box = document.querySelector('.search-box');
            if (!box.contains(e.target)) {
                suggestList.innerHTML = '';
                suggestionsWrapper.style.display = 'none';
            }
        });
    </script>
</body>
</html>
