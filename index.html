<!DOCTYPE html>
<html>
<head>
    <title>MUJ Navigator</title>
    <link rel="icon" type="image/png" href="image/manipal.png">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    
    <style>
        #map { height: 100vh; }
        .search-box {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0px 2px 6px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .search-box input {
            padding: 8px;
            margin: 3px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .info-box {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(255,255,255,0.95);
            padding: 10px;
            font-size: 14px;
            border-radius: 6px;
            box-shadow: 0px 2px 6px rgba(0,0,0,0.2);
            z-index: 1000;
        }
    </style>
</head>
<body>
<div id="map"></div>

<div class="search-box">
    <input id="fromInput" list="locations" placeholder="From...">
    <input id="toInput" list="locations" placeholder="To...">
    <button onclick="route()">Go</button>
    <button onclick="locateMe()">üìç</button>
    <datalist id="locations">
        <option value="AB1">
        <option value="AB2">
        <option value="Central Library">
        <option value="Mess">
        <option value="Laundry">
        <option value="Hostel A">
        <option value="Hostel B">
    </datalist>
</div>

<div class="info-box" id="infoBox">Distance: -<br>Time: -</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script>
// Map init
var map = L.map('map').setView([26.8436, 75.5650], 17);

// Tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 20,
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Load MUJ campus roads
fetch('export.geojson')
    .then(res => res.json())
    .then(data => {
        L.geoJSON(data, {
            style: { color: '#888', weight: 1 }
        }).addTo(map);
    });

// Campus locations
var campusLocations = {
    "AB1": [26.8432, 75.5651],
    "AB2": [26.8438, 75.5645],
    "Central Library": [26.8441, 75.5654],
    "Mess": [26.8435, 75.5658],
    "Laundry": [26.8429, 75.5662],
    "Hostel A": [26.8427, 75.5655],
    "Hostel B": [26.8424, 75.5650]
};

var routingControl;

// Route function
function route() {
    if (routingControl) {
        map.removeControl(routingControl);
    }

    var from = campusLocations[document.getElementById('fromInput').value];
    var to = campusLocations[document.getElementById('toInput').value];

    if (!from || !to) {
        alert("Please select valid locations from suggestions.");
        return;
    }

    routingControl = L.Routing.control({
        waypoints: [L.latLng(from[0], from[1]), L.latLng(to[0], to[1])],
        routeWhileDragging: false,
        createMarker: function() { return null; },
        lineOptions: {
            styles: [{ color: '#007bff', weight: 4 }]
        }
    }).on('routesfound', function(e) {
        var route = e.routes[0];
        var dist = (route.summary.totalDistance / 1000).toFixed(2) + " km";
        var time = Math.round(route.summary.totalTime / 60) + " min";
        document.getElementById('infoBox').innerHTML = `Distance: ${dist}<br>Time: ${time}`;
    }).addTo(map);
}

// Live location
function locateMe() {
    map.locate({setView: true, maxZoom: 18});
}

map.on('locationfound', function(e) {
    L.marker(e.latlng).addTo(map).bindPopup("You are here").openPopup();
});
</script>
</body>
</html>
