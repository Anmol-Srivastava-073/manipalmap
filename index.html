<!DOCTYPE html>
<html lang="en">
<head>
    <title>MUJ Navigator</title>
    <link rel="icon" type="image/png" href="image/manipal.png">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet & plugins CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />

    <style>
        :root{
            --accent1: linear-gradient(135deg,#ff9966,#ff5e62);
            --accent-route: #00bcd4;
            --muted-road: #bfc4c6;
            --glass: rgba(255,255,255,0.12);
            --glass-strong: rgba(255,255,255,0.22);
            --ui-radius: 12px;
            --shadow: 0 10px 30px rgba(12,18,26,0.18);
        }
        html, body {
            height: 100%;
            margin: 0;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        #map {
            height: 100vh;
            width: 100%;
            background: #eaecef;
        }

        /* Top input box */
        .input-box {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1200;
            width: calc(100% - 30px);
            max-width: 820px;
            padding: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-radius: var(--ui-radius);
            background: var(--accent1);
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px) saturate(120%);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }
        .input-left {
            display: flex;
            gap: 10px;
            align-items: center;
            flex: 1 1 auto;
        }
        .input-left input {
            min-width: 130px;
            padding: 10px 12px;
            border-radius: 10px;
            border: none;
            background: rgba(255, 255, 255, 0.14);
            color: white;
            outline: none;
            font-size: 15px;
        }
        .input-left input::placeholder {
            color: rgba(255, 255, 255, 0.95);
            font-style: italic;
        }

        .btn {
            padding: 10px 14px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.18);
            color: #fff;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .icon-btn {
            width: 42px;
            height: 42px;
            padding: 0;
            justify-content: center;
            background: rgba(255, 255, 255, 0.08);
        }

        /* Suggestions box styling */
        #suggestions {
            position: absolute;
            background: #fff;
            border-radius: 8px;
            max-width: 820px;
            width: calc(100% - 30px);
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
            z-index: 1300;
            max-height: 180px;
            overflow-y: auto;
            display: none;
            flex-direction: column;
        }

        #suggestions > div {
            padding: 8px 12px;
            cursor: pointer;
        }
        #suggestions > div:hover {
            background: #e0e0e0;
        }

        /* Info box bottom-left */
        .travel-info-box {
            position: absolute;
            bottom: 14px;
            left: 14px;
            z-index: 1200;
            background: rgba(12, 17, 22, 0.75);
            color: #fff;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 14px;
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(6px);
            min-width: 160px;
        }
        .travel-info-box b {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
        }

        /* Live location toggle */
        .live-toggle {
            position: absolute;
            bottom: 14px;
            right: 14px;
            z-index: 1200;
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            padding: 8px 14px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            cursor: pointer;
            box-shadow: var(--shadow);
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .live-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Responsive */
        @media (max-width: 720px) {
            .input-box {
                width: calc(100% - 18px);
                padding: 8px;
                gap: 8px;
                top: 10px;
            }
            .input-left input {
                min-width: 90px;
                font-size: 14px;
                padding: 9px;
            }
            .btn, .live-toggle {
                padding: 8px 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <!-- INPUTS, SUGGESTIONS, INFO --><!-- unchanged markup from your prior code -->


    <!-- SCRIPTS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- geojson-path-finder from CDN, or host locally -->
    <script src="https://unpkg.com/geojson-path-finder@1.6.0/umd/geojson-path-finder.min.js"></script>
    <script>
    // >>>>>>> CONFIG START

    const MAPBOX_TOKEN = 'pk.eyJ1IjoiYW5tb2xzcml2MDczIiwiYSI6ImNtZTYybGdqeDExNHgybG9sb25mZm8xdDkifQ.9-KhGDc-7Ip4KYTIUOe8tw';
    const WALKING_SPEED_KMPH = 5;
    const LANDMARKS = {
        "AB1 Block": [26.842586, 75.564249],
        "AB2 Block": [26.843117, 75.566100],
        "AB3 Block": [26.844070, 75.564072],
        "BlueDove Mess": [26.840432, 75.561798],
        "BluSpring Mess": [26.841255, 75.561567],
        "Laundry": [26.840202, 75.561454],
        "Central Library": [26.841648, 75.565944],
        "Lecture Hall Complex": [26.844338, 75.564705],
        "Main Gate": [26.840729, 75.566325],
        "Gate 2": [26.841524, 75.563868],
        "Grand Stairs": [26.842811, 75.565360]
    };
    // <<<<<<<< CONFIG END

    // --- MAP INIT ---
    const map = L.map('map').setView([26.8436, 75.5650], 16);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=' + MAPBOX_TOKEN, {
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        attribution: '© Mapbox © OpenStreetMap'
    }).addTo(map);

    // --- LOAD ROADS GEOJSON AND INIT PATHFINDER ---
    let graphGeojson, pathFinder;
    let roadsLayer = null;
    fetch('export.geojson')
        .then(r => r.json())
        .then(data => {
            graphGeojson = data;
            pathFinder = new PathFinder(graphGeojson, { precision: 1e-5 });
            roadsLayer = L.geoJSON(graphGeojson, {
                style: feature => {
                    const c = feature?.properties?.highway || '';
                    if (c === 'footway' || c === 'path') return { color: '#d6d8da', weight: 2, opacity: 0.9 };
                    if (c === 'residential' || c === 'service') return { color: '#c5c9cc', weight: 2, opacity: 0.9 };
                    return { color: '#bfc4c6', weight: 2, opacity: 0.9 };
                }
            }).addTo(map);
        });

    // --- LANDMARK SEARCH ---
    // ... (reuse your landmark suggestion/autocomplete code here) ...

    // --- HELPERS FOR ROUTING ---
        let displayedRoute = null;

function navigate() {
    const fromVal = document.getElementById('from').value.trim();
    const toVal = document.getElementById('to').value.trim();
    if (!fromVal || !toVal) {
        alert('Please fill both From and To fields.');
        return;
    }
    if (!pathFinder) {
        alert('Campus map data not loaded yet.');
        return;
    }
    getCoords(fromVal, fromCoords => {
        getCoords(toVal, toCoords => {
            // Remove previous route if exists
            if (displayedRoute) {
                map.removeLayer(displayedRoute);
                displayedRoute = null;
            }

            // Snap points to network (GeoJSON coords are [lng, lat])
            const fromPoint = { type: "Feature", geometry: { type: "Point", coordinates: [fromCoords[1], fromCoords[0]] }};
            const toPoint   = { type: "Feature", geometry: { type: "Point", coordinates: [toCoords[1], toCoords[0]] }};

            const path = pathFinder.findPath(fromPoint, toPoint);
            if (!path) {
                alert('No campus route found between those points.');
                return;
            }

            // Convert path coords for Leaflet [lat,lng]
            const pathLatLngs = path.path.map(([lng,lat]) => [lat,lng]);

            // Draw route polyline
            displayedRoute = L.polyline(pathLatLngs, {
                color: '#00bcd4',
                weight: 5,
                opacity: 0.96
            }).addTo(map);

            // Add markers for start and end
            L.marker(pathLatLngs[0], {title:'Start'}).addTo(map);
            L.marker(pathLatLngs[pathLatLngs.length - 1], {title:'End'}).addTo(map);

            // Update trip info
            const distKm = path.weight / 1000; // meters to km
            const walkMins = Math.max(1, Math.round((distKm / WALKING_SPEED_KMPH) * 60));
            document.getElementById('travelInfo').innerHTML = `<b>Trip</b>Distance: ${distKm.toFixed(2)} km<br>Time: ${walkMins} mins`;

            // Fit map view
            map.fitBounds(L.polyline(pathLatLngs).getBounds().pad(0.15));
        });
    });
}

    function getCoords(location, callback) {
        location = location.trim();
        if (LANDMARKS[location]) {
            callback(LANDMARKS[location]);
            return;
        }
        const latlonMatch = location.match(/^\s*([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)\s*$/);
        if (latlonMatch) {
            callback([parseFloat(latlonMatch[1]), parseFloat(latlonMatch[3])]);
            return;
        }
        alert('Please enter a valid campus location or coordinates as "lat, lon".');
    }

    let displayedRoute = null;
    function navigate() {
        const fromVal = document.getElementById('from').value.trim();
        const toVal = document.getElementById('to').value.trim();
        if (!fromVal || !toVal) {
            alert('Please fill both From and To fields.');
            return;
        }
        if (!pathFinder) {
            alert('Campus map data not loaded yet.');
            return;
        }
        getCoords(fromVal, fromCoords => {
            getCoords(toVal, toCoords => {
                // Remove previous route
                if (displayedRoute) {
                    map.removeLayer(displayedRoute);
                    displayedRoute = null;
                }

                // Snap inputs to nearest network points
                const fromPoint = { type: "Feature", geometry: { type: "Point", coordinates: [fromCoords[1], fromCoords[0]] }};
                const toPoint   = { type: "Feature", geometry: { type: "Point", coordinates: [toCoords[1], toCoords[0]] }};
                const path = pathFinder.findPath(fromPoint, toPoint);
                if (!path) {
                    alert('No campus route found between those points.');
                    return;
                }
                // Draw the route (reformat [lng,lat] to [lat,lng] for Leaflet)
                const pathLatLngs = path.path.map(([lng,lat]) => [lat,lng]);
                displayedRoute = L.polyline(pathLatLngs, {
                    color: '#00bcd4',
                    weight: 5,
                    opacity: 0.96
                }).addTo(map);

                // Markers
                L.marker(pathLatLngs[0], {title:'Start'}).addTo(map);
                L.marker(pathLatLngs[pathLatLngs.length-1], {title:'End'}).addTo(map);

                // Show trip info
                const distKm = path.weight / 1000; // path.weight is in meters
                const walkMins = Math.max(1, Math.round((distKm / WALKING_SPEED_KMPH) * 60));
                document.getElementById('travelInfo').innerHTML = `<b>Trip</b>Distance: ${distKm.toFixed(2)} km<br>Time: ${walkMins} mins`;

                // Fit to route
                map.fitBounds(L.polyline(pathLatLngs).getBounds().pad(0.15));
            });
        });
    }

    // --- FROM/TO: CURRENT LOCATION BUTTON, ETC. ---

    // Your live location, suggestion, and other UI code can remain almost unchanged.

    </script>
</body>
</html>
