<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Manipal University Jaipur Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
<style>
    body {
        margin: 0;
        padding: 0;
    }
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
    }
    /* Top center search box */
    .search-box {
        position: absolute;
        top: 15px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.6);
        padding: 12px;
        border-radius: 15px;
        display: flex;
        gap: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        z-index: 2;
    }
    input {
        padding: 10px;
        border-radius: 8px;
        border: none;
        font-size: 14px;
        outline: none;
        background: linear-gradient(135deg, #1f4037, #99f2c8);
        color: white;
    }
    input::placeholder {
        color: #f1f1f1;
    }
    button {
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(135deg, #ff512f, #dd2476);
        color: white;
        font-weight: bold;
        cursor: pointer;
    }
    button:hover {
        opacity: 0.85;
    }
    /* Distance & time box bottom-left */
    .info-box {
        position: absolute;
        bottom: 15px;
        left: 15px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 13px;
        max-width: 180px;
        z-index: 2;
        box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
</style>
</head>
<body>

<div id="map"></div>

<div class="search-box">
    <input id="from" list="landmarks" placeholder="From location...">
    <input id="to" list="landmarks" placeholder="To location...">
    <button onclick="findRoute()">Go</button>

    <datalist id="landmarks">
        <option value="Current Location">
        <option value="AB1 Block">
        <option value="AB2 Block">
        <option value="BlueDove Mess">
        <option value="Laundry">
        <option value="Central Library">
        <option value="Main Gate">
        <option value="Gate 2">
        <option value="BluSpring Mess">
        <option value="AB3 Block">
        <option value="Lecture Hall Complex">
        <option value="Grand Stairs">
    </datalist>
</div>

<div class="info-box" id="infoBox">Distance: - <br>Time: -</div>

<script>
mapboxgl.accessToken = 'YOUR_MAPBOX_TOKEN';

// Landmarks coordinates
const landmarks = {
    "AB1 Block": [26.8451, 75.5655],
    "AB2 Block": [26.8459, 75.5648],
    "BlueDove Mess": [26.8465, 75.5653],
    "Laundry": [26.8469, 75.5641],
    "Central Library": [26.8446, 75.5657],
    "Main Gate": [26.8436, 75.5650],
    "Gate 2": [26.8432, 75.5662],
    "BluSpring Mess": [26.8462, 75.5637],
    "AB3 Block": [26.8467, 75.5646],
    "Lecture Hall Complex": [26.8455, 75.5660],
    "Grand Stairs": [26.8449, 75.5659]
};

// Init map
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [75.5650, 26.8436],
    zoom: 16
});

// Function to get coordinates from input
function getCoords(location, callback) {
    if (location.toLowerCase() === "current location") {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => callback([pos.coords.latitude, pos.coords.longitude]),
                () => alert("Unable to fetch current location")
            );
        } else {
            alert("Geolocation not supported by your browser");
        }
    } else if (landmarks[location]) {
        callback(landmarks[location]);
    } else {
        fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(location)}.json?proximity=75.5650,26.8436&limit=1&access_token=${mapboxgl.accessToken}`)
            .then(res => res.json())
            .then(data => {
                if (data.features.length > 0) {
                    callback([data.features[0].center[1], data.features[0].center[0]]);
                } else {
                    alert("Location not found");
                }
            });
    }
}

// Find route
function findRoute() {
    const fromLocation = document.getElementById('from').value;
    const toLocation = document.getElementById('to').value;

    if (!fromLocation || !toLocation) {
        alert("Please enter both locations");
        return;
    }

    getCoords(fromLocation, (fromCoords) => {
        getCoords(toLocation, (toCoords) => {
            fetch(`https://api.mapbox.com/directions/v5/mapbox/walking/${fromCoords[1]},${fromCoords[0]};${toCoords[1]},${toCoords[0]}?steps=true&geometries=geojson&access_token=${mapboxgl.accessToken}`)
                .then(res => res.json())
                .then(data => {
                    const route = data.routes[0].geometry.coordinates;
                    const distance = (data.routes[0].distance / 1000).toFixed(2);
                    const duration = Math.round(data.routes[0].duration / 60);

                    document.getElementById('infoBox').innerHTML = `Distance: ${distance} km<br>Time: ${duration} min`;

                    if (map.getSource('route')) {
                        map.removeLayer('route');
                        map.removeSource('route');
                    }

                    map.addSource('route', {
                        type: 'geojson',
                        data: {
                            type: 'Feature',
                            geometry: { type: 'LineString', coordinates: route }
                        }
                    });

                    map.addLayer({
                        id: 'route',
                        type: 'line',
                        source: 'route',
                        layout: { 'line-join': 'round', 'line-cap': 'round' },
                        paint: { 'line-color': '#ff5733', 'line-width': 5 }
                    });

                    map.flyTo({ center: [(fromCoords[1] + toCoords[1]) / 2, (fromCoords[0] + toCoords[0]) / 2], zoom: 16 });
                });
        });
    });
}
</script>

</body>
</html>
